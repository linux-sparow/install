#!/bin/bash

source /post/profile


#HOSTNAME
echo "$DISTRO_UNIQ" > /etc/hostname &&


## LOCALTIME 
ln -sf /usr/share/zoneinfo/$TIMEZONE /etc/localtime &&
hwclock --systohc &&
timedatectl set-ntp true &&
timedatectl set-timezone $TIMEZONE &&



## LOCALE
locale-gen &&


##
## BOOTUPS
mkdir -p /boot/{efi,kernel,$DISTRO_UNIQ} &&
mkdir -p /boot/efi/{boot,linux,systemd} &&
rm /etc/mkinitcpio.conf &&
rm -fr /etc/mkinitcpio.conf.d/ &&


##
## SERVICE

for dist_daemon in "${DISTRO_DAEMON[@]}"; do
    systemctl enable "$sysd"
done

for dist_global in "${DISTRO_GLOBAL[@]}"; do
  	systemctl enable --global "$sysg"
done


for syst_daemon in "${SYSTEM_DAEMON[@]}"; do
  	systemctl enable "$syst_daemon"
done

for syst_global in "${SYSTEM_GLOBAL[@]}"; do
  	systemctl enable --global "$syst_global"
done


for desk_daemon in "${DESKTOP_DAEMON[@]}"; do
  	systemctl enable "$desk_daemon"
done

for desk_global in "${DESKTOP_GLOBAL[@]}"; do
  	systemctl enable --global "$desk_global"
done




systemctl disable NetworkManager-wait-online.service

##
## BINPATH
chmod +x /usr/xbin/* &&
chmod +x /usr/rbin/* &&



## BOOTING
echo "root=$DISKPROC" > /etc/cmdline.d/01-boot.conf &&
mkinitcpio -P &&


## GRUBERS
echo 'GRUB_DISTRIBUTOR="$DISTRO_NAME"' >> /etc/default/grub &&
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=$DISTRO_UNIQ &&
grub-mkconfig -o /boot/grub/grub.cfg &&


## USERADD
useradd -m $USERNAME &&
usermod -aG wheel $USERNAME &&
echo "add user password" &&
passwd $USERNAME &&


echo "$DISTRO_NAME installation finish, close chroot"